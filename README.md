# Blue Waffle
An AVR based waveshaping/bitreduction pedal

## Introduction
Waveshapers and bitcrushers are pretty much the simplest digital signal processors, but they are very usable and versatile.
There is a strange lack of open-source digital pedals, althogh there certainly is interest for them in the pedal DIY community. This is a perfect starting point for cheap open-source DSP pedals.
##Specs
BlueWaffle is a work-a-like of a commercial pedal, with the following features:
* high-gain analog input preamp
* "AMZ Presence Control" tone control, defeatable
* 8bit signal processing
* 245Hz - 62.5kHz continuously variable (256 steps) sampling rate
* 252 waveforms represented by arrays
* 1 - 8bit output bitrate -or-
* bitmasking (bitwise and) with numbers 0-255
* previous two features available pre- and post-waveshaping
* buffered and filtered output
* CV/exp pedal input for controlling any combination of bitmask/bitdepth and samplerate pots
* 2*7seg displaying current waveform's number in hex

##Implementation
###Hardware
Blue Waffle is made with cheap through-hole components, which is kind of traditional for DIY guitar pedals. It consists of:
* Atmel Atmega1284p microcontroller at the heart of it
* Microchip MCP3001 8bit ADC
* R-2R resistor network based DAC
* several pots, an encoder, and a 2*7seg display
* 7905 voltage regulator, TLE2425 and TLE2426 precision voltage references and TLC2272 output-R2R opamps

###Software
Blue Waffle is written in C, intended for compilation with avr-gcc. Parts of the code are autogenerated from JSON files (the waveforms, in particular) by Python-based [cog](http://nedbatchelder.com/code/cog/) code generation utility. See Waveforms.c's comments for explanation.

MCP3001 communicates to the uC via SPI (without interrupts, busy-waiting). ADC conversions are clocked with Timer0 interrupts.

AVR's own ADC is clocked at 125KHz and used to sample potentiometers and CV input. Display and LEDs are multiplexed on the same 8 outputs, and are alternated on AVRADC interrupts, too.

Modes are implemented by a const struct array - based statemachine which is partially Python-generated.

Encoder and buttons are sampled continuously in the device's main loop.

There's a JS-based waveform generator included in the project  - [WaveformGenerator](http://randrej.github.io/BlueWaffle/). You can use it to draw or make wavetables from functions by pasting arrays into a JSON file (See Waveforms.c's comments for explanation).

##Licence
Original developer: Andrej Radovic (r.andrej@gmail.com)

The firmware is released under a GPL3.0 license.

The PCB layouts and schematics are released under a Creative Commons Attribution-ShareAlike 4.0 International 4.0 (CC-BY-SA-4.0) license.
Documentation and simulations are released under a Creative Commons Attribution-ShareAlike 4.0 International (CC-BY-SA-4.0) license.


![GPL3 logo](http://www.gnu.org/graphics/gplv3-127x51.png) ![CC-BY-SA4.0 logo](http://licensebuttons.net/l/by-sa/4.0/88x31.png)
